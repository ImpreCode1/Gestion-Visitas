generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id         Int     @id @default(autoincrement())
  username   String  @unique
  name       String
  email      String  @unique
  phone      String?
  position   String?
  department String?
  role       String

  deletedAt DateTime? 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  visitasRegistradas Visita[]     @relation("VisitasGerente")
  visitasAprobadas   Visita[]     @relation("VisitasAprobador")
  aprobaciones       Aprobacion[]
}

model Visita {
  id          Int   @id @default(autoincrement())
  gerenteId   Int
  gerente     User  @relation("VisitasGerente", fields: [gerenteId], references: [id])
  aprobadorId Int?
  aprobador   User? @relation("VisitasAprobador", fields: [aprobadorId], references: [id])

  // Datos del cliente (se ingresan manualmente)
  clienteCodigo String
  cliente       String

  direccion     String
  ciudad        String?
  pais          String?
  contacto      String?
  telefono      String?
  personaVisita String?
  motivo        String

  fecha_ida     DateTime
  fecha_regreso DateTime
  lugar         String?
  estado        EstadoVisita @default(pendiente)

  documentos   Documento[]
  aprobaciones Aprobacion[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Documento {
  id        Int           @id @default(autoincrement())
  visitaId  Int
  visita    Visita        @relation(fields: [visitaId], references: [id])
  tipo      TipoDocumento
  url       String
  createdAt DateTime      @default(now())
}

model Aprobacion {
  id          Int              @id @default(autoincrement())
  visitaId    Int
  visita      Visita           @relation(fields: [visitaId], references: [id])
  aprobadorId Int
  aprobador   User             @relation(fields: [aprobadorId], references: [id])
  estado      EstadoAprobacion @default(pendiente)
  comentario  String?
  fecha       DateTime         @default(now())
}

enum EstadoVisita {
  pendiente
  aprobada
  rechazada
  completada
}

enum EstadoAprobacion {
  pendiente
  aprobado
  rechazado
}

enum TipoDocumento {
  factura
  comprobante
  foto
  otro
}
